---
title: "LinearNonLinear_Week7_Assignment_Xingqi"
author: "Xingqi"
date: "February 24, 2015"
output: html_document
---

Week 7 Assignment: Contingency Tables
This project helps understanding techniques for analysis of contingency tables using models for counts data.
This Project is due one week from the date shown in the title part of this document at 11:59 p.m.
This project is individual.

The contingency table that we created today shows counts of iPhone and Android users cross-classified according to whether a user is right-handed or left-handed.

```{r}
y<-c(1,8,1,13)
Handedness<-gl(2,1,4,labels=c("Left-Handed","Right-Handed"))
Phone.Preference<-gl(2,2,labels=c("Android","iPhone"))
Phones<-data.frame(y,Handedness,Phone.Preference)
Phones
```

**Analyze this table using material from Chapter 4 of the book and the workshop description for this week.**

The data can be shown in the xtabs as below.

```{r}
xtab<-xtabs(y~Handedness+Phone.Preference)
xtab
```

From xtab, 1 person is Left-Handed Android phone user. One person is Left-handed iphone user. 8 people are Right-Handed Android users. 13 people are Right-Handed iphone users. This dataset is counts data. These outcomes occurring at different rates and that I could form Poisson model for these rates.

**Estimate Poisson and binomial models.**

The full poisson model is generated as below.

```{r}
model.poisson<-glm(y~Handedness+Phone.Preference, Phones, family=poisson)
summary(model.poisson)
```

The deviance in this model is 0.1063  on 1  degrees of freedom. This deviance is much lower than the deviance 19.4966  on 3  degrees of freedom in null model. So this full Poisson model is better than null model. Only the slope of HandednessRight-Handed in this model is significant. The intercept and the slope of Phone.PreferenceiPhone are not significant. Next, I test the significance of the individual predictors by drop1.

**Apply drop1() to analyze significance of factors. Describe how drop1() works.**

Drop1() is used as below.

```{r}
drop1(model.poisson,test="Chi")
```

Only handedness predictor is significant relative to full model. The phone.perference predictor is not significant relative to full model. These results are in consistent to the summary of full model.

The drop 1 function compare the full model with the model either drop first predictor or drop second predictor. The manual models of dropping first predictor or second predictor are generated as below.


```{r}
model.poisson.1<-summary(glm(y~Phone.Preference, Phones, family=poisson))
model.poisson.2<-summary(glm(y~Handedness, Phones, family=poisson))
model.poisson.1
model.poisson.2
```

I can obeserve same results as in the output of drop1().

**Analyze the fit using deviance.**

The pchisq of above model are analysis as below.

```{r}
pchisq(deviance(model.poisson),df.residual(model.poisson),lower=FALSE)
pchisq(deviance(model.poisson.1),df.residual(model.poisson.1),lower=FALSE)
pchisq(deviance(model.poisson.2),df.residual(model.poisson.2),lower=FALSE)
```

The full model or the Poisson model only with handness predictor is sufficient to fit the dataset. The poisson model only with phone.preference is not sufficient to fit the dataset.

**Fit binomial model to test homogeneity.**

I used a binomial model for the response for both groups of Lefthanded and Righthanded. The following matrix is constructed using the counts.


```{r}
library(stats)
m<-matrix(y,nrow=2)
addmargins(m)
```

To test homogeneity, a binomial model is generated on the matrix as below.

```{r}
model.bin<-glm(m~1,family=binomial)
summary(model.bin)
```

Let's have a close look on the output of this binomial model.

```{r}
model.bin$y
m[1,1]/sum(m[1,])
m[2,1]/sum(m[2,])
```

The output of y values in model.bin are corresponding to the possibility using Android in either Left-Handed or Right-Handed groups.


```{r}
android.p<-sum(m[,1])/sum(m[,])
log.odds.android<-log(android.p/(1-android.p))
cbind(log.odds.android, model.bin$coef)
```

The log value of odds of using Android is calculated. The coefficiency of model.bin is equal to the log vale of odds of using Android.

```{r}
p.fitted<-exp(model.bin$coef)/(1+exp(model.bin$coef))
model.bin$fitted.values
cbind(p.fitted,model.bin$fitted.values)
```

The fitted values can be calculated from the coefficiency of model.bin using the formula above. 

The deviance of the model and pchisq test of the residuals are listed as below.

```{r}
deviance(model.bin)
pchisq(deviance(model.bin),df.residual(model.bin),lower=FALSE)
```


The null hypothesis of testing homogeneity is that the response are the same in both the Lefthanded and righthanded groups.The null hypothesis of the binomial model in this part is that the probability of the response is the same in both the Lefthanded and righthanded groups. The deviance of this binomial model is the same as the full Poisson model in the last part of analysis. pchisq test show that the binomial model fit the dataset well. So I can conclude that the predictor handness is irrelevant to the outcome. 

